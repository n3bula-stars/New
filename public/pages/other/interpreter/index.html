<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeteZah | HTML Interpreter</title>
    <link rel="icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/PeteZah-Games/PeteZahGames@main/public/storage/images/logo-png-removebg-preview.png">
    <style>
        body {margin:0;padding:0;height:100vh;overflow:hidden;background-color:#0A1D37;display:flex;justify-content:center;align-items:center;}
        .game-view {width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;}
        .game-view iframe {width:100%;height:100%;border:none;}
        .error-message {color:white;font-family:'Poppins',sans-serif;font-size:24px;text-align:center;padding:20px;}
    </style>
</head>
<body>
    <div class="game-view" id="gameView">
        <iframe id="gameFrame"></iframe>
    </div>
    <script>
        async function loadHtmlFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            if (!url) {
                showError('No URL provided in query parameters.');
                return;
            }
            try {
                let normalizedUrl = url;
                if (!normalizedUrl.endsWith('index.html') && !normalizedUrl.match(/\.\w+$/)) {
                    normalizedUrl = normalizedUrl.replace(/\/$/, '') + '/index.html';
                }
                const response = await fetch(normalizedUrl + '?t=' + Date.now(), {mode: 'cors'});
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                let html = await response.text();
                const baseUrl = normalizedUrl.replace(/\/[^\/]*$/, '/');
                const gameFrame = document.getElementById('gameFrame');
                gameFrame.contentDocument.open();
                gameFrame.contentDocument.write(html);
                gameFrame.contentDocument.close();
                const scripts = gameFrame.contentDocument.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = gameFrame.contentDocument.createElement('script');
                    if (oldScript.src) {
                        newScript.src = oldScript.src.startsWith('http') ? oldScript.src : baseUrl + oldScript.src;
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            } catch (error) {
                console.error('Error loading HTML:', error);
                showError(`Failed to load HTML: ${error.message}`);
            }
        }
        function showError(message) {
            const gameView = document.getElementById('gameView');
            gameView.innerHTML = `<div class="error-message">${message}</div>`;
        }
        document.addEventListener('DOMContentLoaded', loadHtmlFromUrl);
    </script>
</body>
</html>