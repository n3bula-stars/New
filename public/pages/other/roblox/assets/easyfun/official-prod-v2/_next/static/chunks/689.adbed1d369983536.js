"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689,5688],{30689:(e,t,a)=>{a.r(t),a.d(t,{default:()=>eE});var o,n=a(6379),s=a(55247),l=a(42305),r=a(49952),i=a(64510),c=a(94907),d=a(43030),u=a(2285),p=a(70839),h=a(54644);function m(){let e=(0,s.useAtomValue)(i.ee),t=(0,c.useMemo)(()=>e!==h.k3.默认,[e]);return{isEmbed:t,isExeEmbed:(0,c.useMemo)(()=>e===h.k3.EXE内嵌,[e]),isThirdPartyEmbed:(0,c.useMemo)(()=>e===h.k3.第三方内嵌,[e])}}var x=a(68878),f=a(55688),b=a(15285),g=a(70248),v=a(38061),j=a(46497),y=a(24148),N=a(48568),w=a(37545),A=a(18269);function z(e){let{ref:t}=e,{isOpen:a}=(0,s.useAtomValue)(i.BM),o=(0,u.yF)((e,t,a)=>{t(i.BM,e=>({...e,isOpen:a}))}),l=(0,s.useAtomValue)(i.h4),{mobile:r}=(0,s.useAtomValue)(i.Gl),{isExeEmbed:h}=m(),{fullscreen:z}=(0,s.useAtomValue)(i.Gl),k=(0,c.useRef)(null);return(0,c.useEffect)(()=>(z&&!k.current?(o(!0),k.current=setTimeout(()=>{o(!1),k.current&&(clearTimeout(k.current),k.current=null)},1500)):!z&&a&&o(!1),()=>{k.current&&(clearTimeout(k.current),k.current=null)}),[z]),(0,n.jsxs)(p._s.Root,{open:a,onOpenChange:o,container:t.current,children:[(0,n.jsx)(p._s.Trigger,{asChild:!0}),(0,n.jsxs)(p._s.Portal,{children:[(0,n.jsx)(p._s.Overlay,{className:"absolute inset-0"}),(0,n.jsx)(p._s.Content,{className:"absolute-bottom-start mt-24 h-fit w-full flex flex-col rd-t-2 bg-black-1 bg-op-80 outline-none backdrop-blur-md","aria-describedby":void 0,children:(0,n.jsxs)("div",{className:"flex-1 rd-t-2 p-4",children:[(0,n.jsx)("div",{"aria-hidden":!0,className:"mx-auto mb-4 h-1.5 w-12 flex-shrink-0 rd-full bg-black-3"}),(0,n.jsxs)("div",{className:"mx-auto",children:[(0,n.jsx)(d.s6,{asChild:!0,children:(0,n.jsx)(p._s.Title,{})}),(0,n.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,n.jsx)(A.A,{}),(0,n.jsx)("div",{className:"flex gap-2",children:l.status===x.n.EDIT?(0,n.jsx)(f.default,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Jp,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(y.mv,{})}),(0,n.jsx)(w.vC,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(w.it,{})}),(0,n.jsx)(b.A,{}),!r&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N.iL,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(N.Tu,{})}),(0,n.jsx)(v.RQ,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(v.em,{})})]}),(0,n.jsx)(g.Vf,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(g.EI,{})}),h?(0,n.jsx)(j.lD,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(j.P7,{})}):(0,n.jsx)(j.Ah,{className:"button size-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",children:(0,n.jsx)(j.P7,{})})]})})]})]})]})})]})]})}function k(){let e=(0,c.useRef)(null);return(0,n.jsx)("div",{id:"float-control-bar",className:"absolute-top-start size-full",ref:e,children:(0,n.jsx)(z,{ref:e})})}var O=a(79802);let C={x:0,y:0,width:60,height:60};function M(e){let{children:t,...a}=e,{isOpen:o,isTouching:r}=(0,s.useAtomValue)(i.BM),[d]=(0,c.useState)(Math.trunc(Math.max(12,C.width))),p=(0,c.useDeferredValue)(d),h=(0,s.useAtomValue)(i.Gl),{isEmbed:x}=m(),f=(0,c.useMemo)(()=>x||h.fullscreen,[x,h.fullscreen]),b=(0,c.useMemo)(()=>({fontSize:"".concat(p,"px")}),[p]),g=(0,c.useRef)(null);(0,c.useEffect)(()=>{var e;null==(e=g.current)||e.updatePosition({x:0,y:0})},[h.horizontal]);let v=(0,c.useRef)(0),j=(0,u.yF)((e,t)=>{v.current=Date.now(),t(i.BM,e=>({...e,isTouching:!0}))}),y=(0,u.yF)((e,t)=>{Date.now()-v.current<100&&t(i.BM,e=>({...e,isOpen:!e.isOpen})),t(i.BM,e=>({...e,isTouching:!1}))});return(0,n.jsx)(O.p,{id:"control-bar-anchor",bounds:"parent",lockAspectRatio:!0,default:C,enableResizing:!1,disableDragging:!f,ref:g,...a,onDragStart:j,onDragStop:y,"data-visible":f,className:"data-[visible=true]:pointer-events-auto data-[visible=false]:pointer-events-none data-[visible=false]:op-0 data-[visible=true]:op-100",children:(0,n.jsx)("div",{className:(0,l.A)("group relative transition-colors [&_*]:text-1em"),style:b,"data-open":o,"data-touching":r,children:t})})}function S(e){let{...t}=e;return(0,n.jsx)("button",{type:"button",className:"button m-0 rd-full bg-transparent p-0",...t})}function T(){return(0,n.jsx)("div",{className:(0,l.A)("size-1em flex-center of-hidden rd-full bg-black-1 bg-op-10 transition-colors","group-data-[open=true]:bg-op-70","group-data-[touching=true]:bg-op-70"),children:(0,n.jsx)("div",{className:(0,l.A)("size-0.7em flex-center rd-full bg-white-1 bg-op-7 transition-colors","group-data-[open=true]:bg-op-30","group-data-[touching=true]:bg-op-30"),children:(0,n.jsx)("div",{className:(0,l.A)("size-0.6em flex-center rd-full bg-white-1 bg-op-8 transition-colors","group-data-[open=true]:bg-op-40","group-data-[touching=true]:bg-op-40"),children:(0,n.jsx)("div",{className:(0,l.A)("size-0.5em flex-center rd-full bg-white-1 bg-op-10 transition-colors","group-data-[open=true]:bg-op-100","group-data-[touching=true]:bg-op-100")})})})})}function I(e){let{className:t,...a}=e,o=(0,u.yF)((e,t,a)=>{a.preventDefault();let{status:o}=e(i.h4);if(o===x.n.EDIT){let e=a.target.getBoundingClientRect(),o=a.clientX-e.left,n=a.clientY-e.top;t(i.h4,e=>({...e,status:x.n.EDIT,mousePanel:{top:n,left:o}}))}}),s=(0,u.yF)((e,t,a)=>{let{status:o,mousePanel:n}=e(i.h4);o===x.n.EDIT&&n&&(a.preventDefault(),t(i.h4,e=>({...e,mousePanel:void 0})))});return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:(0,l.A)("keypad-panel size-full",t),...a,onContextMenu:o,onClick:s})})}var R=a(29561),E=a(60574),D=a(76518),L=a(1670);let P=(0,L.default)(()=>a.e(4752).then(a.bind(a,24752)),{loadableGenerated:{webpack:()=>[24752]},ssr:!1}),F=(0,L.default)(()=>a.e(2379).then(a.bind(a,72379)),{loadableGenerated:{webpack:()=>[72379]},ssr:!1}),G=(0,L.default)(()=>a.e(7171).then(a.bind(a,7171)),{loadableGenerated:{webpack:()=>[7171]},ssr:!1}),B=(0,L.default)(()=>a.e(1271).then(a.bind(a,61271)),{loadableGenerated:{webpack:()=>[61271]},ssr:!1}),V={[D.ee.TOUCH]:P,[D.ee.ZOOM]:G,[D.ee.ROTATION]:F,[D.ee.COMPASS]:B};function H(e){let{type:t}=e,a=V[t];return(0,n.jsx)("div",{className:(0,l.A)("size-full flex flex-col items-center"),children:(0,n.jsx)("div",{className:(0,l.A)("absolute-top-center size-0.8em flex-center c-white-1 c-op-50 transition-colors","group-hover:c-op-100"),children:(0,n.jsx)(a,{className:"size-0.8em"})})})}function U(e){let{id:t,children:a,className:o,defaultRect:s,...r}=e,[i]=(0,c.useState)(Math.trunc(Math.max(12,s.width))),d=(0,c.useDeferredValue)(i),u=(0,c.useMemo)(()=>({fontSize:"".concat(d,"px")}),[d]);return(0,n.jsx)(O.p,{id:"panel-keypad-".concat(t),lockAspectRatio:!0,className:(0,l.A)("group",o),default:s,enableResizing:!1,...r,children:(0,n.jsx)("div",{className:(0,l.A)("relative size-full cursor-pointer b-2px b-white-1 b-op-0 b-dashed p-0.05em transition-colors [&_*]:text-1em"),style:u,children:(0,n.jsx)("div",{className:(0,l.A)("relative size-full"),children:(0,n.jsx)("div",{className:(0,l.A)("size-full flex-center b-0.01666em b-white-1 b-op-10 rd-full b-solid p-0.03333em transition-colors group-hover:b-op-100"),children:(0,n.jsx)("div",{className:(0,l.A)("size-full flex-center rd-full bg-white-1 bg-op-10 transition-colors"),children:a})})})})})}let _={width:60,height:60,x:0,y:0},W={width:150,height:150},K={code:["KeyW","KeyA","KeyS","KeyD"],name:{[D.bB.UP]:"W",[D.bB.LEFT]:"A",[D.bB.DOWN]:"S",[D.bB.RIGHT]:"D"}},X=[];function q(e){let{elementX:t,elementY:a}=e,o="#keypad-area",d=(0,s.useAtomValue)(i.h4),p=(0,E.c3)("cloud-game-area"),{hasZoom:h,hasRotate:m}=(0,r.gT)(),x=(0,c.useMemo)(()=>{if(!d.mousePanel)return{};let e=Math.max(d.mousePanel.left+24,0);return{position:"absolute",left:e,top:Math.max(d.mousePanel.top+20,0),opacity:1}},[d.mousePanel]),f=(0,c.useRef)({}),b=(0,c.useCallback)((e,t)=>{f.current[e]=t},[]),g=(0,u.yF)((e,o,n)=>{let{control:s}=e(i.Lp);if(n===D.ee.COMPASS){let{width:e,height:o}=W;s.addControlArea({...K,x:t-e/2,y:a-o/2,width:e,height:o,type:n,zIndex:1})}else{let{width:e,height:o}=_,{name:l,code:r}=(X.length||(X="EASYFUN".split("").map(e=>({name:e,code:["Key".concat(e)]}))),X.shift());s.addControlArea({name:l,code:r,x:t-e/2,y:a-o/2,width:e,height:o,type:n,zIndex:1})}f.current[n].updatePosition({x:0,y:0})});return d.mousePanel?(0,n.jsx)("div",{className:"pointer-events-auto rd-8px bg-black-2 bg-op-30 p-16px",style:x,children:(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-16px",children:[(0,n.jsxs)("div",{className:"group",children:[(0,n.jsx)("div",{className:"relative size-60px",children:(0,n.jsx)(U,{id:"TOUCH",bounds:o,defaultRect:_,ref:e=>{b(D.ee.TOUCH,e)},onDragStop:()=>g(D.ee.TOUCH),children:(0,n.jsx)(H,{type:D.ee.TOUCH})})}),(0,n.jsx)("div",{className:"mt-4px text-center text-12px c-white-1 c-op-70 font-600 transition-colors group-hover:c-op-100",children:p("keypad-click")})]}),(0,n.jsxs)("div",{className:"group",children:[(0,n.jsx)("div",{className:"relative size-60px",children:(0,n.jsx)(U,{id:"COMPASS",bounds:o,defaultRect:_,ref:e=>{b(D.ee.COMPASS,e)},onDragStop:()=>g(D.ee.COMPASS),children:(0,n.jsx)(H,{type:D.ee.COMPASS})})}),(0,n.jsx)("div",{className:"mt-4px text-center text-12px c-white-1 c-op-70 font-600 transition-colors group-hover:c-op-100",children:p("keypad-arrow")})]}),(0,n.jsxs)("div",{className:(0,l.A)("group","data-[disable=true]:pointer-events-none data-[disable=true]:op-30"),"data-disable":m,children:[(0,n.jsx)("div",{className:"relative size-60px",children:(0,n.jsx)(U,{id:"ROTATION",bounds:o,defaultRect:_,disableDragging:m,ref:e=>{b(D.ee.ROTATION,e)},onDragStop:()=>g(D.ee.ROTATION),children:(0,n.jsx)(H,{type:D.ee.ROTATION})})}),(0,n.jsx)("div",{className:"mt-4px text-center text-12px c-white-1 c-op-70 font-600 transition-colors group-hover:c-op-100",children:p("keypad-rotate")})]}),(0,n.jsxs)("div",{className:(0,l.A)("group","data-[disable=true]:pointer-events-none data-[disable=true]:op-30"),"data-disable":h,children:[(0,n.jsx)("div",{className:"relative size-60px",children:(0,n.jsx)(U,{id:"ZOOM",bounds:o,defaultRect:_,disableDragging:h,ref:e=>{b(D.ee.ZOOM,e)},onDragStop:()=>g(D.ee.ZOOM),children:(0,n.jsx)(H,{type:D.ee.ZOOM})})}),(0,n.jsx)("div",{className:"mt-4px text-center text-12px c-white-1 c-op-70 font-600 transition-colors group-hover:c-op-100",children:p("keypad-zoom")})]})]})}):(0,n.jsx)(n.Fragment,{})}function J(e){let{elementX:t,elementY:a,panelActive:o}=e,s=(0,E.c3)("cloud-game-area"),l=(0,c.useMemo)(()=>Number.isNaN(t)?{display:"none"}:{position:"absolute",left:Math.max(t+24,0),top:Math.max(a+20,0),opacity:t<0||a<0?0:1},[t,a]);return(0,n.jsx)("div",{className:"flex-center rd-8px bg-black-2 bg-op-30 px-16px py-12px font-600",style:l,children:(0,n.jsx)("div",{className:"whitespace-nowrap text-14px c-#fff c-op-90 font-600 lh-1em",children:s(o?"keypad-show-menu-cursor-tips":"keypad-hide-menu-cursor-tips")})})}function Y(){let e=(0,R.A)(()=>document.querySelector("#keypad-area")),t=(0,s.useAtomValue)(i.h4);return t.status!==x.n.EDIT?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[!!t.mousePanel&&(0,n.jsx)(q,{elementX:e.elementX,elementY:e.elementY}),(0,n.jsx)(J,{elementX:e.elementX,elementY:e.elementY,panelActive:!!t.mousePanel})]})}let Z=(0,L.default)(()=>a.e(4752).then(a.bind(a,24752)),{loadableGenerated:{webpack:()=>[24752]},ssr:!1}),Q=(0,L.default)(()=>a.e(2379).then(a.bind(a,72379)),{loadableGenerated:{webpack:()=>[72379]},ssr:!1}),$=(0,L.default)(()=>a.e(7171).then(a.bind(a,7171)),{loadableGenerated:{webpack:()=>[7171]},ssr:!1}),ee=(0,L.default)(()=>a.e(3408).then(a.bind(a,43408)),{loadableGenerated:{webpack:()=>[43408]},ssr:!1});function et(e){let{data:t,...a}=e;switch(t.type){case D.ee.TOUCH:return(0,n.jsx)(eo,{data:t,...a,children:(0,n.jsx)(Z,{className:"size-0.8em"})});case D.ee.ZOOM:return(0,n.jsx)(eo,{data:t,...a,children:(0,n.jsx)($,{className:"size-0.8em"})});case D.ee.ROTATION:return(0,n.jsx)(eo,{data:t,...a,children:(0,n.jsx)(Q,{className:"size-0.8em"})});case D.ee.COMPASS:return(0,n.jsx)(en,{data:t,...a,children:(0,n.jsx)(ee,{className:"size-0.8em"})})}}function ea(e){let{children:t,onDoubleClick:a,direction:o,keyId:s,editId:r,editDirection:i,className:c}=e;return(0,n.jsxs)("div",{className:(0,l.A)("parent relative z-2 cursor-text p-0.0666em c-white-1 c-op-50 font-600 transition-colors","group-hover:c-op-100","group-data-[active=true]:c-op-100","group-data-[hot=true]:c-op-100","data-[edit=true]:c-cyan-5",c),onDoubleClick:()=>null==a?void 0:a(o),"data-edit":s===r&&i===o,children:[t,(0,n.jsx)("i",{className:"absolute-bottom-center bottom--0.05em h-0.1em w-80% animate-flash animate-duration-1.5s animate-count-infinite rd-full bg-current parent-data-[edit=false]:hidden"})]})}function eo(e){let{children:t,data:a,...o}=e;return(0,n.jsxs)("div",{className:(0,l.A)("size-full flex flex-col items-center justify-end"),children:[(0,n.jsx)("div",{className:(0,l.A)("absolute-top-center size-0.8em flex-center c-white-1 c-op-50 transition-colors","group-hover:c-op-100","group-data-[active=true]:c-op-100","group-data-[hot=true]:c-op-100"),children:t}),(0,n.jsx)(ea,{...o,className:"text-0.2em",children:String(a.name).toLocaleUpperCase()})]})}function en(e){var t,a,o,s;let{children:r,data:i,...c}=e;return(0,n.jsxs)("div",{className:(0,l.A)("relative size-full flex-center"),children:[(0,n.jsx)("div",{className:(0,l.A)("absolute-center-center size-0.8em flex-center c-white-1 c-op-50 transition-colors","group-hover:c-op-100","group-data-[active=true]:c-op-100","group-data-[hot=true]:c-op-100"),children:r}),(0,n.jsxs)("div",{className:"relative size-full",children:[(0,n.jsx)("div",{className:"absolute left-1/2 top-0.1em -translate-x-1/2",children:(0,n.jsx)(ea,{direction:D.bB.UP,...c,className:"text-0.1em",children:null==(t=String(i.name[D.bB.UP]))?void 0:t.toLocaleUpperCase()})}),(0,n.jsx)("div",{className:"absolute left-0.1em top-1/2 -translate-y-1/2",children:(0,n.jsx)(ea,{direction:D.bB.LEFT,...c,className:"text-0.1em",children:null==(a=String(i.name[D.bB.LEFT]))?void 0:a.toLocaleUpperCase()})}),(0,n.jsx)("div",{className:"absolute bottom-0.1em left-1/2 -translate-x-1/2",children:(0,n.jsx)(ea,{direction:D.bB.DOWN,...c,className:"text-0.1em",children:null==(o=String(i.name[D.bB.DOWN]))?void 0:o.toLocaleUpperCase()})}),(0,n.jsx)("div",{className:"absolute right-0.1em top-1/2 -translate-y-1/2",children:(0,n.jsx)(ea,{direction:D.bB.RIGHT,...c,className:"text-0.1em",children:null==(s=String(i.name[D.bB.RIGHT]))?void 0:s.toLocaleUpperCase()})})]})]})}var es=a(87441);function el(){return(el=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)({}).hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(null,arguments)}let er=function(e){return c.createElement("svg",el({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 8 8"},e),o||(o=c.createElement("path",{fill:"#fff",fillOpacity:.9,fillRule:"evenodd",d:"M5.768 1.172a.75.75 0 1 1 1.06 1.06L2.232 6.828a.75.75 0 0 1-1.06-1.06L2.939 4 1.172 2.232a.75.75 0 0 1 1.06-1.06L4 2.939zm1.06 5.656a.75.75 0 0 0 0-1.06l-.53-.53a.75.75 0 0 0-1.06 1.06l.53.53a.75.75 0 0 0 1.06 0",clipRule:"evenodd"})))},ei={topLeft:"top-left flex-center aspect-square",topRight:"top-right flex-center aspect-square",bottomLeft:"bottom-left flex-center aspect-square",bottomRight:"bottom-right flex-center aspect-square"},ec=(0,n.jsx)("i",{className:"size-6px rd-50% bg-cyan-5"}),ed={topLeft:ec,topRight:ec,bottomLeft:ec,bottomRight:ec},eu={topLeft:{left:"-5px",top:"-5px",width:"10px",height:"10px",position:"absolute"},topRight:{right:"-5px",top:"-5px",width:"10px",height:"10px",position:"absolute"},bottomLeft:{left:"-5px",bottom:"-5px",width:"10px",height:"10px",position:"absolute"},bottomRight:{right:"-5px",bottom:"-5px",width:"10px",height:"10px",position:"absolute"},left:{top:"0px",left:"-5px",width:"10px",height:"100%",position:"absolute"},top:{left:"0px",top:"-5px",width:"100%",height:"10px",position:"absolute"},right:{top:"0px",right:"-5px",width:"10px",height:"100%",position:"absolute"},bottom:{left:"0px",bottom:"-5px",width:"100%",height:"10px",position:"absolute"}};function ep(e){let{id:t,children:a,className:o,data:s,wRatio:r,hRatio:i,useType:d,style:u,onRemove:p,onBlur:h,...m}=e,x=(0,c.useMemo)(()=>({x:s.x*r,y:s.y*i,width:s.width*r,height:s.height*r}),[r,i,s.x,s.y,s.width,s.height]),[f,b]=(0,c.useState)(Math.trunc(Math.max(12,x.width))),g=(0,c.useDeferredValue)(f),v=(0,c.useMemo)(()=>({fontSize:"".concat(g,"px")}),[g]),[j,y]=(0,c.useState)(!1),N=(0,c.useRef)(null),[w,A]=(0,c.useState)(!1);return(0,es.A)(()=>{w&&(A(!1),null==h||h())},N),(0,n.jsx)(O.p,{id:"keypad-".concat(t),lockAspectRatio:!0,className:(0,l.A)("group","data-[type=EDIT]:pointer-events-auto","data-[type=ADD]:pointer-events-auto","data-[type=HIDE]:pointer-events-none data-[type=HIDE]:opacity-0","data-[type=SHOW]:pointer-events-none data-[type=SHOW]:opacity-100",o),default:x,resizeHandleClasses:ei,resizeHandleStyles:eu,resizeHandleComponent:ed,enableResizing:w,style:u,minWidth:"12px",minHeight:"12px","data-type":d,"data-active":w,...m,onResize:(e,t,a,o,n)=>{b(Math.trunc(Math.max(12,Number.parseInt(a.style.width))))},children:(0,n.jsxs)("div",{ref:N,className:(0,l.A)("relative size-full cursor-pointer b-2px b-white-1 b-op-0 b-dashed p-0.05em transition-colors [&_*]:text-1em","group-data-[active=true]:b-op-10"),style:v,onClick:e=>{A(!0)},children:[(0,n.jsx)("div",{className:(0,l.A)("relative size-full","group-data-[active=true]:[mask-image:url(~@/assets/svg/keypad-gui/mask.svg)]","group-hover:[mask-image:url(~@/assets/svg/keypad-gui/mask.svg)]"),children:(0,n.jsx)("div",{className:(0,l.A)("size-full flex-center b-0.01666em b-white-1 b-op-10 rd-full b-solid p-0.03333em transition-colors group-hover:b-op-100","group-data-[active=true]:b-cyan-5 group-data-[active=true]:b-op-100","group-data-[hot=true]:b-cyan-5 group-data-[hot=true]:b-op-100","data-[delete=true]:b-red-5! data-[delete=true]:b-op-100!"),"data-delete":j,children:(0,n.jsx)("div",{className:(0,l.A)("size-full flex-center rd-full bg-white-1 bg-op-10 transition-colors","group-data-[hot=true]:bg-cyan-5 group-data-[hot=true]:bg-op-10"),children:a})})}),(0,n.jsx)("div",{className:(0,l.A)("absolute right-0 top-0 m-0.025em size-0.25em flex-center cursor-pointer b-transparent rd-full bg-white-1 bg-op-10 op-0 transition-colors hover:bg-red-5 group-hover:op-100","group-data-[active=true]:op-100"),onMouseOver:()=>y(!0),onMouseLeave:()=>y(!1),onClick:p,children:(0,n.jsx)(er,{className:"size-50%"})})]})})}function eh(){let e=(0,s.useAtomValue)(i.h4),{control:t}=(0,s.useAtomValue)(i.Lp),{wRatio:a,hRatio:o}=(0,r.Mp)(),{keyboardKeys:l}=(0,r.hI)(),{editId:c,direction:d,hotKeyIdList:u,triggerSetKey:p}=(0,r.NI)();return(0,n.jsx)(n.Fragment,{children:l.map(s=>{let{id:l,data:r}=s,i="".concat(l,"-").concat(a,"-").concat(o);return(0,n.jsx)(ep,{data:r,id:i,useType:e.status,wRatio:a,hRatio:o,bounds:"parent","data-hot":u.has(l),onResizeStop:(e,a,o,n,s)=>t.setControlArea({width:o.offsetWidth,height:o.offsetHeight,x:s.x,y:s.y},l),onDragStop:(e,a)=>t.setControlArea({x:a.x,y:a.y},l),onRemove:()=>t.deleteControlArea(l),onBlur:()=>p("",void 0),children:(0,n.jsx)(et,{data:r,keyId:l,editId:c,editDirection:d,onDoubleClick:e=>p(l,e)})},i)})})}var em=a(33489),ex=a(65585);function ef(e){let{className:t,...a}=e,o=(0,c.useRef)(null),r=(0,em.A)(o),d=(0,ex.A)(document),{control:u}=(0,s.useAtomValue)(i.Lp),p=(0,c.useMemo)(()=>matchMedia("(hover: none)").matches,[]);(0,c.useEffect)(()=>{o.current&&u.setControlLayerElement(o.current)},[o,u,r,d]);let h=(0,c.useMemo)(()=>p?{onTouchStart:u.down,onTouchMove:u.move,onTouchEnd:u.up,onTouchCancel:u.up}:{onMouseDown:u.down,onMouseMove:u.move,onMouseUp:u.up},[p,u.down,u.move,u.up]);return(0,n.jsx)("div",{ref:o,className:(0,l.A)("control-panel size-full",t),...a,...h})}var eb=a(85327);function eg(){let e=(0,s.useAtomValue)(i.X0),{updateWatermark:t}=function(){let e={};async function t(t){return Object.keys(e).length||(e=new eb.yN({width:200,height:150,rotate:0,fontColor:"#ffffff",fontSize:"36px",fontFamily:"Helvetica, Arial, Bebas Neue, sans-serif",contentType:"multi-line-text",globalAlpha:.01})),e.changeOptions(t,"append")}return(0,c.useEffect)(()=>()=>{var t;null==e||null==(t=e.destroy)||t.call(e)},[]),{updateWatermark:t,watermark:e}}();return(0,c.useEffect)(()=>{e.device.deviceId&&t({content:"".concat(e.device.deviceId),parent:document.querySelector("#fullscreen-element")})},[e.device.deviceId]),(0,n.jsx)(n.Fragment,{})}let ev=(0,L.default)(()=>a.e(4886).then(a.bind(a,44886)),{loadableGenerated:{webpack:()=>[44886]},ssr:!1});function ej(e){let{children:t,className:a,...o}=e;return(0,n.jsx)("div",{className:(0,l.A)("flex flex-col gap-2 c-white-1",a),...o,children:(0,n.jsx)(ev,{className:"w-24 op-10"})})}var ey=a(92752);function eN(){let e=(0,c.useRef)(null),t=(0,c.useRef)(null),a=(0,c.useRef)(null),o=(0,c.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,a.current&&clearTimeout(a.current),a.current=null},[]),l=(0,u.yF)(e=>{let{wss:n}=e(i.Lp);n.send(D.LJ.FORCEI,{}),o(),t.current=setInterval(()=>{n.send(D.LJ.FORCEI,{})},1e3),a.current=setTimeout(()=>{o()},1e4),n.effect(()=>{o()},[D.LJ.WSS_CLOSE])}),r=(0,u.yF)(t=>{let{rtc:a,wss:o}=t(i.Lp);a.effect(t=>{e.current&&t&&(e.current.srcObject=t)},[D.L6.STREAM]),o.effect(()=>{l()},[D.LJ.RTC_INIT])}),d=(0,s.useAtomValue)(i.X0);(0,c.useEffect)(()=>(d.device.deviceId&&(console.log("video initEffect"),r()),()=>{o()}),[d.device.deviceId]);let{setPlayingStatus:p,setIdleStatus:h}=(0,ey.G4)(),m=(0,u.yF)(e=>{var t;let{wss:a}=e(i.Lp),n=e(i.i7),s=e(i.C8),{done:l}=e(i.ii);(null==(t=a.getWSInstance())?void 0:t.readyState)===WebSocket.OPEN?(console.log("有画面信息 并且wss连接成功"),l(),p(),o(),l(),p(),o(),a.send(D.LJ.AUDIO_MUTE,{muted:n}),a.send(D.LJ.SWITCH_QUALITY,{quality:s})):(console.log("返回画面信息 但是wss连接失败"),l(),h(),o())}),x=(0,u.yF)(e=>{let{rtc:t}=e(i.Lp);t.videoUpdateTimeout()}),f=(0,s.useAtomValue)(i.i7);return(0,n.jsx)("video",{ref:e,className:"size-full","webkit-playsinline":"true",autoPlay:!0,disablePictureInPicture:!0,playsInline:!0,"x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":"true","x5-video-orientation":"portraint",muted:f,onLoadedData:m,onTimeUpdate:x})}function ew(){let e=(0,s.useAtomValue)(i.Gl),{viewportRef:t,videoStyle:a,panelStyle:o,controlAreaStyle:c}=(0,r.Gj)();return(0,n.jsxs)("section",{id:"rtc-window",className:(0,l.A)("relative size-full select-none"),ref:t,onContextMenu:e=>e.preventDefault(),children:[(0,n.jsxs)("div",{"data-tag":"VIDEO_AND_CONTROL",className:"parent relative",style:a,children:[(0,n.jsx)("div",{id:"video-area",className:"size-full bg-black-1",children:(0,n.jsx)(eN,{})}),(0,n.jsx)("div",{className:"absolute-top-start size-full flex-center",children:(0,n.jsx)("div",{id:"control-area",className:"relative aspect-ratio-9/16 [&_*]:[cursor:url(~@/assets/svg/cursor.svg),default]!",style:c,children:(0,n.jsx)(ef,{children:(0,n.jsx)(I,{})})})})]}),(0,n.jsx)("div",{"data-tag":"PANEL_AND_WATERMARK",className:"parent pointer-events-none absolute-top-start relative flex-center",style:o,children:(0,n.jsxs)("div",{className:(0,l.A)("relative flex-center of-hidden [&_*]:[cursor:url(~@/assets/svg/cursor.svg),default]!","data-[horizontal=true]:aspect-ratio-16/9 data-[horizontal=true]:h-auto data-[horizontal=true]:w-full","data-[horizontal=false]:aspect-ratio-9/16 data-[horizontal=false]:h-full data-[horizontal=false]:w-auto"),"data-horizontal":e.horizontal,children:[(0,n.jsxs)("div",{id:"keypad-area",className:"size-full data-[mobile=true]:hidden","data-mobile":e.mobile,children:[(0,n.jsx)(eh,{}),(0,n.jsx)(Y,{})]}),(0,n.jsx)(ej,{className:"absolute inset-ie-10px top-10px"}),(0,n.jsx)(k,{}),(0,n.jsx)(M,{children:(0,n.jsx)(S,{children:(0,n.jsx)(T,{})})})]})}),(0,n.jsx)(eg,{})]})}var eA=a(28032),ez=a(4505),ek=a(84126),eO=a(84459),eC=a(16983);let eM={deviceId:0x756b5b3,phoneId:"1",accessPort:8e3,publicIp:"1"};function eS(){return(0,n.jsx)(c.Suspense,{fallback:(0,n.jsx)(n.Fragment,{}),children:(0,n.jsx)(eT,{})})}function eT(){let{getKeyboardMap:e}=(0,r.f8)(),t=(0,s.useAtomValue)(i.Gl),{fakeInitConnection:a}=(0,ey.BW)(),{fakeInitConnection:o}=(0,ey.F6)(),{isIOS:l}=(0,eO.Y)(),d=(0,u.yF)((t,n)=>{a(),n(i.X0,e=>({...e,device:eM})),o(),e(),n(i.n6,x.fJ.游玩),setTimeout(()=>{let e=document.querySelector("#control-area");null==e||e.style.setProperty("background-color","rgb(0 204 177 / 0.4)")},1e3)}),p=(0,u.yF)((e,a)=>{let{wss:o}=e(i.Lp);o.hookEvent(D._5.NOTIFY,{data:{rotation:+!t.horizontal}})}),h=(0,u.yF)((e,t)=>{t(i.Gl,e=>({...e,mobile:!e.mobile}))}),m=(0,ez.useSearchParams)(),f=(0,c.useMemo)(()=>"1"===m.get("whosyourdaddy"),[m]);return(0,c.useEffect)(()=>{"1"===m.get("ineedyourhelp")&&(console.log("i need your help!!!! fake init!!!! RUN DEBUGINGGGGGGGGGGGGGG"),d())},[m]),f&&(0,n.jsxs)("div",{className:"fixed-top-end inset-ie-10 top-10 z-999 flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"button h-10 w-20 text-3",children:[t.mobile?"手机":"PC"," ","-",l?"IOS":"其他"]}),(0,n.jsx)(j.Ah,{type:"button",className:"button h-10 w-20 button-cyan text-3",children:t.fullscreen?"全屏":"窗口"}),(0,n.jsx)("button",{type:"button",className:"button h-10 w-20 button-orange text-3",onClick:p,children:t.horizontal?"横屏":"竖屏"}),(0,n.jsx)("button",{type:"button",className:"button h-10 w-20 button-yellow text-3",onClick:h,children:t.mobile?"手机":"PC"}),(0,n.jsx)(eR,{})]})}let eI=[{name:"".concat(eC.o.太多请求," 太多请求"),code:eC.o.太多请求},{name:"".concat(eC.o.重复连接," 重复连接"),code:eC.o.重复连接},{name:"".concat(eC.o.没有更多设备," 没有更多设备"),code:eC.o.没有更多设备,response:{data:{queueValue:10}}},{name:"".concat(eC.o.长时间没有控制," 长时间没有控制"),code:eC.o.长时间没有控制},{name:"".concat(eC.o.连接断开," 连接断开"),code:eC.o.连接断开},{name:"".concat(eC.o.连接错误," 连接错误"),code:eC.o.连接错误},{name:"".concat(eC.o.设备过期," 设备过期"),code:eC.o.设备过期},{name:"".concat(eC.o.游戏不存在," 游戏不存在"),code:eC.o.游戏不存在},{name:"".concat(eC.o.游戏ID错误," 游戏ID错误"),code:eC.o.游戏ID错误},{name:"".concat(eC.o.游戏ID为空," 游戏ID为空"),code:eC.o.游戏ID为空},{name:"".concat(eC.o.用户Token错误," 用户Token错误"),code:eC.o.用户Token错误},{name:"".concat(eC.o.排队信息," 排队信息"),code:eC.o.排队信息,response:{data:{queueValue:5}}},{name:"".concat(eC.o.游戏暂停," 游戏暂停"),code:eC.o.游戏暂停},{name:"".concat(eC.o.用户ID错误," 用户ID错误"),code:eC.o.用户ID错误},{name:"".concat(eC.o.用户Token为空," 用户Token为空"),code:eC.o.用户Token为空},{name:"".concat(eC.o.没有更多使用时间," 没有更多使用时间"),code:eC.o.没有更多使用时间},{name:"".concat(eC.o.添加游戏时间," 添加游戏时间"),code:eC.o.添加游戏时间},{name:"".concat(eC.o.设备信息," 设备信息"),code:eC.o.设备信息,response:{data:{device:eM}}},{name:"".concat(eC.o.已分配设备并结束排队," 已分配设备并结束排队"),code:eC.o.已分配设备并结束排队},{name:"".concat(eC.o.心跳," 心跳"),code:eC.o.心跳},{name:"".concat(eC.o.关闭," 关闭"),code:eC.o.关闭}];function eR(){let e=(0,u.yF)((e,t,a)=>{let{businessWss:o}=e(i.Lp);o.hookEvent(a.code,a.response)});return(0,n.jsxs)(ek.Popover,{children:[(0,n.jsx)(ek.PopoverTrigger,{asChild:!0,children:(0,n.jsx)("button",{type:"button",className:(0,l.A)("button h-10 w-20 button-white text-3"),children:"业务 WSS"})}),(0,n.jsx)(eA.ZL,{container:document.getElementById("fullscreen-element"),children:(0,n.jsxs)(eA.UC,{"data-slot":"popover-content",align:"center",sideOffset:4,className:(0,l.A)("data-[state=open]:animate-zoom-in data-[state=open]:animate-duration-150","data-[state=closed]:animate-zoom-out data-[state=closed]:animate-duration-150","bg-popover z-49 origin-[--radix-popover-content-transform-origin] b rd-2 shadow-md outline-hidden","rd-3 bg-white-1 p-2"),children:[(0,n.jsx)("div",{className:"flex flex-col",children:eI.map(t=>(0,n.jsx)("div",{className:(0,l.A)("flex cursor-pointer items-center justify-between gap-2 rd-1 px-2 py-1.5 text-3 c-black-2 hover:bg-cyan-5/10 hover:c-cyan-5"),onClick:()=>e(t),children:t.name},t.code))}),(0,n.jsx)(ek.PopoverArrow,{className:"fill-white-1"})]})})]})}function eE(){let e=(0,s.useAtomValue)(i.X0);return(0,n.jsxs)(n.Fragment,{children:[!!(null==e?void 0:e.device.deviceId)&&(0,n.jsx)(ew,{}),(0,n.jsx)(eS,{})]})}},55688:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});var o,n,s,l,r,i=a(6379),c=a(96820),d=a(42305),u=a(55247),p=a(2285),h=a(60574),m=a(94907);function x(){return(x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)({}).hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(null,arguments)}let f=function(e){return m.createElement("svg",x({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"},e),o||(o=m.createElement("path",{fill:"currentColor",d:"M10.828 5.172a1 1 0 0 0-1.414 0L8 6.586 6.586 5.172a1 1 0 1 0-1.414 1.414L6.586 8 5.172 9.414a1 1 0 1 0 1.414 1.414l4.242-4.242a1 1 0 0 0 0-1.414M9.06 9.06a1 1 0 0 1 1.415 0l.353.354a1 1 0 1 1-1.414 1.414l-.353-.353a1 1 0 0 1 0-1.414"})),n||(n=m.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 0c6.4 0 8 1.6 8 8s-1.6 8-8 8-8-1.6-8-8 1.6-8 8-8m0 2c3.214 0 4.422.45 4.986 1.014S14 4.786 14 8s-.45 4.422-1.014 4.986S11.214 14 8 14s-4.422-.45-4.986-1.014S2 11.214 2 8s.45-4.422 1.014-4.986S4.786 2 8 2",clipRule:"evenodd"})))};function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)({}).hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(null,arguments)}let g=function(e){return m.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"},e),s||(s=m.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"m12.936 10.621-2.864 2.864H15a1 1 0 1 1 0 2H7.039l-.107.006-.453.017a3 3 0 0 1-2.232-.877l-2.61-2.61a3 3 0 0 1 0-4.243L8 1.414a2 2 0 0 1 2.829 0l4.243 4.243a2 2 0 0 1 0 2.828l-2.107 2.107-.014.015zM9.415 2.828l4.242 4.243-1.414 1.414-4.242-4.243zM6.586 5.657 3.051 9.192a1 1 0 0 0 0 1.415l2.61 2.61a1 1 0 0 0 .744.292l.453-.017a1 1 0 0 0 .67-.292l3.301-3.3z",clipRule:"evenodd"})))};function v(){return(v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)({}).hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(null,arguments)}let j=function(e){return m.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"},e),l||(l=m.createElement("path",{fill:"currentColor",d:"M4 5a1 1 0 0 1 2 0v1a1 1 0 0 1-2 0zM8 4a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0V5a1 1 0 0 0-1-1M10 5a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0z"})),r||(r=m.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M13 16a3 3 0 0 0 3-3V5.657a4 4 0 0 0-1.172-2.829l-1.656-1.656A4 4 0 0 0 10.343 0H3a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3zM10.343 2H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v3h1a1 1 0 0 0 1-1V5.657a2 2 0 0 0-.586-1.414l-1.657-1.657A2 2 0 0 0 10.343 2M10 12H6v2h4z",clipRule:"evenodd"})))};var y=a(92752),N=a(26586),w=a(64510),A=a(81715),z=a(68878);let k=["100012023053114570000148806","100012023032917500000069431","100012023031317000000057722","2001240410132398562","2001240410132293521","100012023072109450000232467","2001240625145693532","100012023042417220000093513","2001240401143495252"];function O(){let e=(0,h.c3)("cloud-game-area"),t=(0,u.useAtomValue)(A.XM),{toastError:a,toastSuccess:o}=(0,y.FM)(),n=(0,m.useMemo)(()=>!Number("1")||k.includes(t.uid),[t.uid]),s=(0,m.useRef)(void 0),l=(0,p.yF)(e=>{let{control:t}=e(w.Lp);s.current=t.getStatusInfo().configKeyboard});(0,m.useEffect)(()=>{l()},[]);let r=(0,p.yF)((e,t)=>{t(w.h4,e=>({...e,status:e.isShowPresetKeyGUI?z.n.SHOW:z.n.HIDE}))}),x=(0,p.yF)((e,t,n)=>{let{control:l}=e(w.Lp);n?(o("Success!"),s.current=l.getStatusInfo().configKeyboard):a(),r()}),b=(0,p.yF)(async e=>{let{control:t}=e(w.Lp),{uid:a,token:o,gameId:n}=e(w.CN),s=t.getStatusInfo().configKeyboard;x(await (0,N.mk)({uid:a,token:o,gameId:n,button:JSON.stringify(s)}))}),v=(0,p.yF)(e=>{let{control:t}=e(w.Lp);t.updateStatusInfo(e=>({...e,configKeyboard:s.current}))}),O=(0,p.yF)(async(e,t)=>{let a=e(w.CN),{control:o}=e(w.Lp),n=o.getStatusInfo().configKeyboard,s={...a,configType:0,configData:JSON.stringify(n)},l=await (0,N.zL)(s);if(x(l),!s.buttonId&&l){let e=await (0,N.C4)(a);if(null==e?void 0:e.length){let{buttonId:a}=e[0];t(w.h4,e=>({...e,buttonId:a}))}}let r=e(w.vB);(0,c.sendGTMEvent)({event:"save-custom-keyboard",uid:a.uid,gameName:r.gameName})});return(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsx)("button",{type:"button",className:"button h-9 bg-white-1 bg-op-10 c-white-1 hover:c-cyan-5",onClick:b,children:(0,i.jsx)("span",{className:"text-3",children:"Publish"})}),(0,i.jsxs)("button",{type:"button",className:(0,d.A)("button h-9 bg-white-1 bg-op-10 c-orange-5","hover:bg-orange-5 hover:bg-op-50 hover:c-white-1 hover:c-op-100"),onClick:v,children:[(0,i.jsx)(g,{className:"size-3.5"}),(0,i.jsx)("span",{className:"text-3",children:e("keypad-reset")})]}),(0,i.jsxs)("button",{type:"button",className:(0,d.A)("button h-9 bg-white-1 bg-op-10 c-red-5","hover:bg-red-5 hover:bg-op-50 hover:c-white-1 hover:c-op-100"),onClick:r,children:[(0,i.jsx)(f,{className:"size-3.5"}),(0,i.jsx)("span",{className:"text-3",children:e("keypad-quit")})]}),(0,i.jsxs)("button",{type:"button",className:(0,d.A)("button h-9 bg-white-1 bg-op-10 c-cyan-5","hover:bg-cyan-5 hover:bg-op-50 hover:c-white-1 hover:c-op-100"),onClick:O,children:[(0,i.jsx)(j,{className:"size-3.5"}),(0,i.jsx)("span",{className:"text-3",children:e("keypad-save")})]})]})}},84126:(e,t,a)=>{a.d(t,{Popover:()=>l,PopoverArrow:()=>i,PopoverContent:()=>c,PopoverTrigger:()=>r});var o=a(6379),n=a(28032),s=a(42305);function l(e){let{...t}=e;return(0,o.jsx)(n.bL,{"data-slot":"popover",...t})}function r(e){let{...t}=e;return(0,o.jsx)(n.l9,{"data-slot":"popover-trigger",...t})}function i(e){let{...t}=e;return(0,o.jsx)(n.i3,{"data-slot":"popover-arrow",...t})}function c(e){let{className:t,align:a="center",sideOffset:l=4,...r}=e;return(0,o.jsx)(n.ZL,{children:(0,o.jsx)(n.UC,{"data-slot":"popover-content",align:a,sideOffset:l,className:(0,s.A)("data-[state=open]:animate-zoom-in data-[state=open]:animate-duration-150","data-[state=closed]:animate-zoom-out data-[state=closed]:animate-duration-150","bg-popover z-49 origin-[--radix-popover-content-transform-origin] b rd-2 shadow-md outline-hidden",t),...r})})}a(94907)}}]);